const c=`{% block frosh_abandoned_carts_list %} <sw-page class="frosh-abandoned-carts-list"> {% block frosh_abandoned_carts_list_smart_bar_header %} <template #smart-bar-header> <h2> {{ $tc('frosh-abandoned-carts.list.title') }} <span v-if="!isLoading" class="sw-page__smart-bar-amount" > ({{ total }}) </span> </h2> </template> {% endblock %} {% block frosh_abandoned_carts_list_content %} <template #content> <div class="frosh-abandoned-carts-list__content"> {% block frosh_abandoned_carts_list_empty_state %} <sw-empty-state v-if="!isLoading && !total" :title="$tc('frosh-abandoned-carts.list.emptyStateTitle')" /> {% endblock %} {% block frosh_abandoned_carts_list_grid %} <sw-entity-listing v-else :repository="abandonedCartRepository" :items="abandonedCarts" :columns="columns" :isLoading="isLoading" :allowEdit="false" :allowDelete="false" :allowInlineEdit="false" :disableDataFetching="true" :sortBy="sortBy" :sortDirection="sortDirection" detailRoute="frosh.abandoned.carts.detail" @page-change="onPageChange" @column-sort="onSortColumn" > {% block frosh_abandoned_carts_list_column_customer %} <template #column-customer.email="{ item }"> <router-link :to="{ name: 'frosh.abandoned.carts.detail', params: { id: item.id } }" > {{ getCustomerName(item) }} </router-link> </template> {% endblock %} {% block frosh_abandoned_carts_list_column_total_price %} <template #column-totalPrice="{ item }"> {{ formatPrice(item.totalPrice, item.currencyIsoCode) }} </template> {% endblock %} {% block frosh_abandoned_carts_list_column_sales_channel %} <template #column-salesChannel.name="{ item }"> {{ item.salesChannel ? item.salesChannel.name : '-' }} </template> {% endblock %} {% block frosh_abandoned_carts_list_column_created_at %} <template #column-createdAt="{ item }"> <sw-time-ago :date="item.createdAt"/> </template> {% endblock %} </sw-entity-listing> {% endblock %} </div> </template> {% endblock %} {% block frosh_abandoned_carts_list_sidebar %} <template #sidebar> <sw-sidebar class="frosh-abandoned-carts-list__sidebar"> {% block frosh_abandoned_carts_list_sidebar_refresh %} <sw-sidebar-item icon="regular-undo" :title="$tc('frosh-abandoned-carts.list.refresh')" @click="onRefresh" /> {% endblock %} {% block frosh_abandoned_carts_list_sidebar_filter %} <sw-sidebar-filter-panel entity="frosh_abandoned_cart" :store-key="storeKey" :filters="listFilters" :defaults="defaultFilters" :active-filter-number="activeFilterNumber" @criteria-changed="updateCriteria" /> {% endblock %} </sw-sidebar> </template> {% endblock %} </sw-page> {% endblock %}`,{Mixin:m}=Shopware,{Criteria:i}=Shopware.Data;Shopware.Component.register("frosh-abandoned-carts-list",{template:c,inject:["repositoryFactory","filterFactory"],mixins:[m.getByName("listing")],data(){return{abandonedCarts:null,isLoading:!0,sortBy:"createdAt",sortDirection:"DESC",filterCriteria:[],defaultFilters:["sales-channel-filter","customer-filter"],storeKey:"grid.filter.frosh_abandoned_cart",activeFilterNumber:0}},computed:{abandonedCartRepository(){return this.repositoryFactory.create("frosh_abandoned_cart")},columns(){return[{property:"customer.email",label:this.$tc("frosh-abandoned-carts.list.columnCustomer"),allowResize:!0,primary:!0},{property:"totalPrice",label:this.$tc("frosh-abandoned-carts.list.columnTotalPrice"),allowResize:!0},{property:"salesChannel.name",label:this.$tc("frosh-abandoned-carts.list.columnSalesChannel"),allowResize:!0},{property:"createdAt",label:this.$tc("frosh-abandoned-carts.list.columnCreatedAt"),allowResize:!0}]},listFilterOptions(){return{"sales-channel-filter":{property:"salesChannel",label:this.$tc("frosh-abandoned-carts.list.filterSalesChannel"),placeholder:this.$tc("frosh-abandoned-carts.list.filterSalesChannelPlaceholder")},"customer-filter":{property:"customer",label:this.$tc("frosh-abandoned-carts.list.filterCustomer"),placeholder:this.$tc("frosh-abandoned-carts.list.filterCustomerPlaceholder"),labelProperty:"email"}}},listFilters(){return this.filterFactory.create("frosh_abandoned_cart",this.listFilterOptions)},defaultCriteria(){const t=new i(this.page,this.limit);return t.addAssociation("customer"),t.addAssociation("salesChannel"),t.addSorting(i.sort(this.sortBy,this.sortDirection)),this.filterCriteria.forEach(a=>{t.addFilter(a)}),t}},watch:{defaultCriteria:{handler(){this.getList()},deep:!0}},methods:{async getList(){this.isLoading=!0;try{const t=await Shopware.Service("filterService").mergeWithStoredFilters(this.storeKey,this.defaultCriteria),a=await this.abandonedCartRepository.search(t,Shopware.Context.api);this.abandonedCarts=a,this.total=a.total}catch(t){console.error("Failed to load abandoned carts:",t)}finally{this.isLoading=!1}},updateCriteria(t){this.page=1,this.filterCriteria=t,this.activeFilterNumber=t.length},onRefresh(){this.getList()},getCustomerName(t){return t.customer?`${t.customer.firstName} ${t.customer.lastName} (${t.customer.email})`:"-"},formatPrice(t,a){return new Intl.NumberFormat("de-DE",{style:"currency",currency:a||"EUR"}).format(t)}}});const u=`{% block frosh_abandoned_carts_detail %} <sw-page class="frosh-abandoned-carts-detail"> {% block frosh_abandoned_carts_detail_smart_bar_header %} <template #smart-bar-header> <h2> {{ $tc('frosh-abandoned-carts.detail.title') }} </h2> </template> {% endblock %} {% block frosh_abandoned_carts_detail_smart_bar_actions %} <template #smart-bar-actions> <mt-button variant="secondary" @click="$router.push({ name: 'frosh.abandoned.carts.list' })" > {{ $tc('global.default.cancel') }} </mt-button> </template> {% endblock %} {% block frosh_abandoned_carts_detail_content %} <template #content> <sw-card-view v-if="abandonedCart"> {% block frosh_abandoned_carts_detail_card_info %} <sw-card position-identifier="frosh-abandoned-carts-detail-info" :title="$tc('frosh-abandoned-carts.detail.cardTitleInfo')" :isLoading="isLoading" > <sw-container columns="1fr 1fr" gap="16px" > <sw-description-list> <dt> {{ $tc('frosh-abandoned-carts.detail.labelCustomer') }} </dt> <dd> <router-link v-if="abandonedCart.customer" :to="{ name: 'sw.customer.detail', params: { id: abandonedCart.customerId } }" > {{ getCustomerName() }} </router-link> <template v-else>-</template> </dd> <dt> {{ $tc('frosh-abandoned-carts.detail.labelSalesChannel') }} </dt> <dd> {{ abandonedCart.salesChannel ? abandonedCart.salesChannel.name : '-' }} </dd> </sw-description-list> <sw-description-list> <dt> {{ $tc('frosh-abandoned-carts.detail.labelTotalPrice') }} </dt> <dd> {{ formatPrice(abandonedCart.totalPrice) }} </dd> <dt> {{ $tc('frosh-abandoned-carts.detail.labelCreatedAt') }} </dt> <dd> <sw-time-ago :date="abandonedCart.createdAt"/> </dd> </sw-description-list> </sw-container> </sw-card> {% endblock %} {% block frosh_abandoned_carts_detail_card_line_items %} <sw-card position-identifier="frosh-abandoned-carts-detail-line-items" :title="$tc('frosh-abandoned-carts.detail.cardTitleLineItems')" :isLoading="isLoading" > <sw-data-grid v-if="abandonedCart.lineItems && abandonedCart.lineItems.length > 0" :dataSource="abandonedCart.lineItems" :columns="lineItemColumns" :showSelection="false" :showActions="false" > {% block frosh_abandoned_carts_detail_line_items_column_label %} <template #column-label="{ item }"> <router-link v-if="item.productId" :to="{ name: 'sw.product.detail', params: { id: item.productId } }" > {{ getProductName(item) }} </router-link> <template v-else> {{ getProductName(item) }} </template> </template> {% endblock %} {% block frosh_abandoned_carts_detail_line_items_column_unit_price %} <template #column-unitPrice="{ item }"> {{ formatPrice(item.unitPrice) }} </template> {% endblock %} {% block frosh_abandoned_carts_detail_line_items_column_total_price %} <template #column-totalPrice="{ item }"> {{ formatPrice(item.totalPrice) }} </template> {% endblock %} </sw-data-grid> <sw-empty-state v-else :title="$tc('frosh-abandoned-carts.detail.unknownProduct')" /> </sw-card> {% endblock %} </sw-card-view> <sw-loader v-else/> </template> {% endblock %} </sw-page> {% endblock %}`,{Criteria:h}=Shopware.Data;Shopware.Component.register("frosh-abandoned-carts-detail",{template:u,inject:["repositoryFactory"],props:{abandonedCartId:{type:String,required:!0}},data(){return{abandonedCart:null,isLoading:!0}},computed:{abandonedCartRepository(){return this.repositoryFactory.create("frosh_abandoned_cart")},criteria(){const t=new h;return t.addAssociation("customer"),t.addAssociation("salesChannel"),t.addAssociation("lineItems.product"),t},lineItemColumns(){return[{property:"label",label:this.$tc("frosh-abandoned-carts.detail.columnProduct"),allowResize:!0,primary:!0},{property:"quantity",label:this.$tc("frosh-abandoned-carts.detail.columnQuantity"),allowResize:!0,width:"100px"},{property:"unitPrice",label:this.$tc("frosh-abandoned-carts.detail.columnUnitPrice"),allowResize:!0,width:"150px"},{property:"totalPrice",label:this.$tc("frosh-abandoned-carts.detail.columnTotalPrice"),allowResize:!0,width:"150px"}]}},created(){this.loadAbandonedCart()},methods:{async loadAbandonedCart(){this.isLoading=!0;try{this.abandonedCart=await this.abandonedCartRepository.get(this.abandonedCartId,Shopware.Context.api,this.criteria)}catch(t){console.error("Failed to load abandoned cart:",t)}finally{this.isLoading=!1}},getCustomerName(){var a;if(!((a=this.abandonedCart)!=null&&a.customer))return"-";const t=this.abandonedCart.customer;return`${t.firstName} ${t.lastName} (${t.email})`},formatPrice(t){var e;const a=((e=this.abandonedCart)==null?void 0:e.currencyIsoCode)||"EUR";return new Intl.NumberFormat("de-DE",{style:"currency",currency:a}).format(t)},getProductName(t){var a;return t.product?((a=t.product.translated)==null?void 0:a.name)||t.product.name:t.label||this.$tc("frosh-abandoned-carts.detail.unknownProduct")}}});const b=`{% block frosh_abandoned_carts_statistics %} <sw-page class="frosh-abandoned-carts-statistics"> {% block frosh_abandoned_carts_statistics_smart_bar_header %} <template #smart-bar-header> <h2> {{ $tc('frosh-abandoned-carts.statistics.title') }} </h2> </template> {% endblock %} {% block frosh_abandoned_carts_statistics_content %} <template #content> <template v-if="isLoading"> <sw-skeleton variant="detail"/> <sw-skeleton variant="detail"/> </template> <template v-else> {% block frosh_abandoned_carts_statistics_summary %} <div class="frosh-abandoned-carts-statistics__summary"> <mt-card position-identifier="frosh-abandoned-carts-statistics-summary" > <div class="frosh-abandoned-carts-statistics__summary-grid"> {% block frosh_abandoned_carts_statistics_summary_total_count %} <div class="frosh-abandoned-carts-statistics__summary-item" > <span class="frosh-abandoned-carts-statistics__summary-label" > {{ $tc('frosh-abandoned-carts.statistics.totalCount') }} </span> <span class="frosh-abandoned-carts-statistics__summary-value" > {{ totalCount }} </span> </div> {% endblock %} {% block frosh_abandoned_carts_statistics_summary_total_value %} <div class="frosh-abandoned-carts-statistics__summary-item" > <span class="frosh-abandoned-carts-statistics__summary-label" > {{ $tc('frosh-abandoned-carts.statistics.totalValue') }} </span> <span class="frosh-abandoned-carts-statistics__summary-value" > {{ formatPrice(totalValue) }} </span> </div> {% endblock %} {% block frosh_abandoned_carts_statistics_summary_today_count %} <div class="frosh-abandoned-carts-statistics__summary-item" > <span class="frosh-abandoned-carts-statistics__summary-label" > {{ $tc('frosh-abandoned-carts.statistics.todayCount') }} </span> <span class="frosh-abandoned-carts-statistics__summary-value" > {{ todayCount }} </span> </div> {% endblock %} {% block frosh_abandoned_carts_statistics_summary_today_value %} <div class="frosh-abandoned-carts-statistics__summary-item" > <span class="frosh-abandoned-carts-statistics__summary-label" > {{ $tc('frosh-abandoned-carts.statistics.todayValue') }} </span> <span class="frosh-abandoned-carts-statistics__summary-value" > {{ formatPrice(todayValue) }} </span> </div> {% endblock %} </div> </mt-card> </div> {% endblock %} {% block frosh_abandoned_carts_statistics_charts %} <template v-if="hasData"> {% block frosh_abandoned_carts_statistics_chart_count %} <sw-chart-card class="frosh-abandoned-carts-statistics__chart-count" :available-ranges="availableRanges" :card-subtitle="getCardSubtitle(countDateRange)" :series="countSeries" :options="chartOptionsCount" :fill-empty-values="'day'" :card-title="$tc('frosh-abandoned-carts.statistics.chartTitleCount')" type="line" sort position-identifier="frosh-abandoned-carts-statistics-chart-count" @sw-chart-card-range-update="onCountRangeUpdate" > <template #range-option="{ range }"> {{ $tc(\`frosh-abandoned-carts.statistics.dateRanges.\${range}\`) }} </template> </sw-chart-card> {% endblock %} {% block frosh_abandoned_carts_statistics_chart_value %} <sw-chart-card class="frosh-abandoned-carts-statistics__chart-value" :available-ranges="availableRanges" :card-subtitle="getCardSubtitle(valueDateRange)" :series="valueSeries" :options="chartOptionsValue" :fill-empty-values="'day'" :card-title="$tc('frosh-abandoned-carts.statistics.chartTitleValue')" type="line" sort position-identifier="frosh-abandoned-carts-statistics-chart-value" @sw-chart-card-range-update="onValueRangeUpdate" > <template #range-option="{ range }"> {{ $tc(\`frosh-abandoned-carts.statistics.dateRanges.\${range}\`) }} </template> </sw-chart-card> {% endblock %} </template> {% block frosh_abandoned_carts_statistics_empty_state %} <sw-empty-state v-else :title="$tc('frosh-abandoned-carts.statistics.emptyStateTitle')" /> {% endblock %} {% endblock %} </template> </template> {% endblock %} </sw-page> {% endblock %}`;Shopware.Component.register("frosh-abandoned-carts-statistics",{template:b,inject:["froshAbandonedCartStatisticsService"],data(){return{isLoading:!0,totalCount:0,totalValue:0,todayCount:0,todayValue:0,historyDataCount:null,historyDataValue:null,countDateRange:{label:"30Days",range:30},valueDateRange:{label:"30Days",range:30}}},computed:{rangesValueMap(){return[{label:"30Days",range:30},{label:"14Days",range:14},{label:"7Days",range:7}]},availableRanges(){return this.rangesValueMap.map(t=>t.label)},chartOptionsCount(){return{xaxis:{type:"datetime",min:this.getDateAgo(this.countDateRange).getTime(),labels:{datetimeUTC:!1}},yaxis:{min:0,tickAmount:3,labels:{formatter:t=>parseInt(t,10)}}}},chartOptionsValue(){return{xaxis:{type:"datetime",min:this.getDateAgo(this.valueDateRange).getTime(),labels:{datetimeUTC:!1}},yaxis:{min:0,tickAmount:5,labels:{formatter:t=>Shopware.Utils.format.currency(Number.parseFloat(t),this.systemCurrencyISOCode,2)}}}},countSeries(){if(!this.historyDataCount)return[];const t=this.historyDataCount.map(a=>({x:this.parseDate(a.date),y:a.count}));return[{name:this.$tc("frosh-abandoned-carts.statistics.chartLabelCount"),data:t}]},valueSeries(){if(!this.historyDataValue)return[];const t=this.historyDataValue.map(a=>({x:this.parseDate(a.date),y:a.value}));return[{name:this.$tc("frosh-abandoned-carts.statistics.chartLabelValue"),data:t}]},systemCurrencyISOCode(){return Shopware.Context.app.systemCurrencyISOCode},currencyFilter(){return Shopware.Filter.getByName("currency")},today(){const t=Shopware.Utils.format.dateWithUserTimezone();return t.setHours(0,0,0,0),t},hasData(){return this.historyDataCount&&this.historyDataCount.length>0}},created(){this.loadStatistics()},methods:{async loadStatistics(){var t;this.isLoading=!0;try{const a=Math.max(this.countDateRange.range,this.valueDateRange.range),e=this.formatDateToISO(this.getDateAgo({range:a})),o=((t=Shopware.Store.get("session").currentUser)==null?void 0:t.timeZone)??"UTC",s=await this.froshAbandonedCartStatisticsService.getStatistics(e,o);this.totalCount=s.totalCount,this.totalValue=s.totalValue,this.todayCount=s.todayCount,this.todayValue=s.todayValue,this.historyDataCount=s.dailyStats,this.historyDataValue=s.dailyStats}catch(a){console.error("Failed to load statistics:",a)}finally{this.isLoading=!1}},getDateAgo(t){const a=Shopware.Utils.format.dateWithUserTimezone();return a.setDate(a.getDate()-t.range),a.setHours(0,0,0,0),a},formatDateToISO(t){return Shopware.Utils.format.toISODate(t,!1)},parseDate(t){return new Date(t.replace(/-/g,"/").replace("T"," ").replace(/\..*|\+.*/,"")).valueOf()},formatChartHeadlineDate(t){const a=Shopware.Application.getContainer("factory").locale.getLastKnownLocale();return t.toLocaleDateString(a,{day:"numeric",month:"short"})},getCardSubtitle(t){return`${this.formatChartHeadlineDate(this.getDateAgo(t))} - ${this.formatChartHeadlineDate(this.today)}`},async onCountRangeUpdate(t){const a=this.rangesValueMap.find(e=>e.label===t);a&&(this.countDateRange=a,await this.loadStatistics())},async onValueRangeUpdate(t){const a=this.rangesValueMap.find(e=>e.label===t);a&&(this.valueDateRange=a,await this.loadStatistics())},formatPrice(t){return this.currencyFilter(t,this.systemCurrencyISOCode,2)}}});const _=`{% block frosh_abandoned_carts_automation_list %} <sw-page class="frosh-abandoned-carts-automation-list"> {% block frosh_abandoned_carts_automation_list_smart_bar_header %} <template #smart-bar-header> <h2> {{ $tc('frosh-abandoned-carts.automations.title') }} <span v-if="!isLoading && automations" class="sw-page__smart-bar-amount" > ({{ automations.total }}) </span> </h2> </template> {% endblock %} {% block frosh_abandoned_carts_automation_list_smart_bar_actions %} <template #smart-bar-actions> <mt-button variant="primary" @click="$router.push({ name: 'frosh.abandoned.carts.automation.create' })" > {{ $tc('frosh-abandoned-carts.automations.createButton') }} </mt-button> </template> {% endblock %} {% block frosh_abandoned_carts_automation_list_content %} <template #content> <div class="frosh-abandoned-carts-automation-list__content"> {% block frosh_abandoned_carts_automation_list_empty_state %} <sw-empty-state v-if="!isLoading && (!automations || automations.total === 0)" :title="$tc('frosh-abandoned-carts.automations.emptyState')" /> {% endblock %} {% block frosh_abandoned_carts_automation_list_grid %} <sw-entity-listing v-else :repository="automationRepository" :items="automations" :columns="columns" :isLoading="isLoading" :allowEdit="true" :allowDelete="true" :allowInlineEdit="false" :disableDataFetching="true" :sortBy="sortBy" :sortDirection="sortDirection" detailRoute="frosh.abandoned.carts.automation.detail" @delete-item="onDelete" > {% block frosh_abandoned_carts_automation_list_column_name %} <template #column-name="{ item }"> <router-link :to="{ name: 'frosh.abandoned.carts.automation.detail', params: { id: item.id } }" > {{ item.name }} </router-link> </template> {% endblock %} {% block frosh_abandoned_carts_automation_list_column_active %} <template #column-active="{ item }"> <mt-icon v-if="item.active" name="regular-checkmark-xs" size="16px" color="#37d046" /> <mt-icon v-else name="regular-times-s" size="16px" color="#de294c" /> </template> {% endblock %} {% block frosh_abandoned_carts_automation_list_column_conditions %} <template #column-conditions="{ item }"> {{ getConditionsSummary(item) }} </template> {% endblock %} {% block frosh_abandoned_carts_automation_list_column_actions %} <template #column-actions="{ item }"> {{ getActionsSummary(item) }} </template> {% endblock %} {% block frosh_abandoned_carts_automation_list_column_sales_channel %} <template #column-salesChannel.name="{ item }"> {{ item.salesChannel ? item.salesChannel.name : $tc('frosh-abandoned-carts.automations.detail.salesChannelPlaceholder') }} </template> {% endblock %} {% block frosh_abandoned_carts_automation_list_column_created_at %} <template #column-createdAt="{ item }"> <sw-time-ago :date="item.createdAt"/> </template> {% endblock %} </sw-entity-listing> {% endblock %} </div> </template> {% endblock %} </sw-page> {% endblock %}`,{Criteria:r}=Shopware.Data;Shopware.Component.register("frosh-abandoned-carts-automation-list",{template:_,inject:["repositoryFactory"],data(){return{automations:null,isLoading:!0,sortBy:"priority",sortDirection:"DESC"}},computed:{automationRepository(){return this.repositoryFactory.create("frosh_abandoned_cart_automation")},columns(){return[{property:"name",label:this.$tc("frosh-abandoned-carts.automations.columns.name"),allowResize:!0,primary:!0},{property:"active",label:this.$tc("frosh-abandoned-carts.automations.columns.active"),allowResize:!0,align:"center",width:"100px"},{property:"conditions",label:this.$tc("frosh-abandoned-carts.automations.columns.conditions"),allowResize:!0,sortable:!1},{property:"actions",label:this.$tc("frosh-abandoned-carts.automations.columns.actions"),allowResize:!0,sortable:!1},{property:"salesChannel.name",label:this.$tc("frosh-abandoned-carts.automations.columns.salesChannel"),allowResize:!0},{property:"createdAt",label:this.$tc("frosh-abandoned-carts.automations.columns.createdAt"),allowResize:!0}]},defaultCriteria(){const t=new r(1,25);return t.addAssociation("salesChannel"),t.addSorting(r.sort(this.sortBy,this.sortDirection)),t}},created(){this.loadAutomations()},methods:{async loadAutomations(){this.isLoading=!0;try{this.automations=await this.automationRepository.search(this.defaultCriteria,Shopware.Context.api)}catch(t){console.error("Failed to load automations:",t)}finally{this.isLoading=!1}},async onDelete(t){try{await this.automationRepository.delete(t.id,Shopware.Context.api),await this.loadAutomations()}catch(a){console.error("Failed to delete automation:",a)}},getConditionsSummary(t){if(!t.conditions||t.conditions.length===0)return"-";const a={cart_age:this.$tc("frosh-abandoned-carts.automations.conditions.cart_age"),cart_value:this.$tc("frosh-abandoned-carts.automations.conditions.cart_value"),automation_count:this.$tc("frosh-abandoned-carts.automations.conditions.automation_count"),time_since_last_automation:this.$tc("frosh-abandoned-carts.automations.conditions.time_since_last_automation"),customer_tag:this.$tc("frosh-abandoned-carts.automations.conditions.customer_tag"),line_item_count:this.$tc("frosh-abandoned-carts.automations.conditions.line_item_count")};return t.conditions.map(e=>a[e.type]||e.type).join(", ")},getActionsSummary(t){if(!t.actions||t.actions.length===0)return"-";const a={send_email:this.$tc("frosh-abandoned-carts.automations.actions.send_email"),generate_voucher:this.$tc("frosh-abandoned-carts.automations.actions.generate_voucher"),add_customer_tag:this.$tc("frosh-abandoned-carts.automations.actions.add_customer_tag"),remove_customer_tag:this.$tc("frosh-abandoned-carts.automations.actions.remove_customer_tag"),set_customer_custom_field:this.$tc("frosh-abandoned-carts.automations.actions.set_customer_custom_field")};return t.actions.map(e=>a[e.type]||e.type).join(", ")}}});const p=`{% block frosh_abandoned_carts_automation_detail %} <sw-page class="frosh-abandoned-carts-automation-detail"> {% block frosh_abandoned_carts_automation_detail_smart_bar_header %} <template #smart-bar-header> <h2> {{ isCreateMode ? $tc('frosh-abandoned-carts.automations.detail.newTitle') : $tc('frosh-abandoned-carts.automations.detail.title') }} </h2> </template> {% endblock %} {% block frosh_abandoned_carts_automation_detail_smart_bar_actions %} <template #smart-bar-actions> <mt-button variant="secondary" @click="$router.push({ name: 'frosh.abandoned.carts.automations' })" > {{ $tc('global.default.cancel') }} </mt-button> <mt-button variant="secondary" :isLoading="isTestLoading" @click="testAutomation" > {{ $tc('frosh-abandoned-carts.automations.detail.testButton') }} </mt-button> <mt-button variant="primary" :isLoading="isLoading" @click="onSave" > {{ $tc('global.default.save') }} </mt-button> </template> {% endblock %} {% block frosh_abandoned_carts_automation_detail_content %} <template #content> <sw-card-view v-if="automation"> {% block frosh_abandoned_carts_automation_detail_card_general %} <sw-card position-identifier="frosh-abandoned-carts-automation-detail-general" :title="$tc('frosh-abandoned-carts.automations.detail.generalCard')" :isLoading="isLoading" > <sw-container columns="1fr 1fr" gap="16px" > <mt-text-field v-model="automation.name" :label="$tc('frosh-abandoned-carts.automations.detail.nameLabel')" :placeholder="$tc('frosh-abandoned-carts.automations.detail.namePlaceholder')" required /> <mt-number-field v-model="automation.priority" :label="$tc('frosh-abandoned-carts.automations.detail.priorityLabel')" :helpText="$tc('frosh-abandoned-carts.automations.detail.priorityHelpText')" :min="1" /> </sw-container> <sw-container columns="1fr 1fr" gap="16px" > <mt-switch v-model="automation.active" :label="$tc('frosh-abandoned-carts.automations.detail.activeLabel')" /> <sw-entity-single-select v-model:value="automation.salesChannelId" entity="sales_channel" :label="$tc('frosh-abandoned-carts.automations.detail.salesChannelLabel')" :placeholder="$tc('frosh-abandoned-carts.automations.detail.salesChannelPlaceholder')" /> </sw-container> </sw-card> {% endblock %} {% block frosh_abandoned_carts_automation_detail_card_conditions %} <sw-card position-identifier="frosh-abandoned-carts-automation-detail-conditions" :title="$tc('frosh-abandoned-carts.automations.detail.conditionsCard')" :isLoading="isLoading" > <div class="frosh-abandoned-carts-automation-detail__conditions"> {% block frosh_abandoned_carts_automation_detail_conditions_list %} <div v-for="(condition, index) in automation.conditions" :key="index" class="frosh-abandoned-carts-automation-detail__condition-row" > <sw-container columns="200px 1fr auto" gap="16px" > <mt-select v-model="condition.type" :label="$tc('frosh-abandoned-carts.automations.detail.conditionType')" :options="conditionTypeOptions" /> <div class="frosh-abandoned-carts-automation-detail__condition-config" > <sw-container columns="repeat(auto-fit, minmax(120px, 1fr))" gap="8px" > <mt-select v-if="needsValueInput(condition.type)" v-model="condition.operator" :label="$tc('frosh-abandoned-carts.automations.detail.operator')" :options="operatorOptions" /> <mt-number-field v-if="needsValueInput(condition.type)" v-model="condition.value" :label="$tc('frosh-abandoned-carts.automations.detail.value')" /> <mt-select v-if="needsUnitInput(condition.type)" v-model="condition.unit" :label="$tc('frosh-abandoned-carts.automations.detail.unit')" :options="unitOptions" /> <sw-entity-single-select v-if="needsTagInput(condition.type)" v-model:value="condition.tagId" entity="tag" :label="$tc('frosh-abandoned-carts.automations.detail.tagId')" /> <mt-switch v-model="condition.negate" :label="$tc('frosh-abandoned-carts.automations.detail.negate')" /> </sw-container> </div> <mt-button square size="small" variant="secondary" @click="removeCondition(index)" > <mt-icon name="regular-trash" size="16px" /> </mt-button> </sw-container> </div> {% endblock %} {% block frosh_abandoned_carts_automation_detail_conditions_add %} <mt-button variant="secondary" size="small" @click="addCondition" > {{ $tc('frosh-abandoned-carts.automations.detail.addCondition') }} </mt-button> {% endblock %} </div> </sw-card> {% endblock %} {% block frosh_abandoned_carts_automation_detail_card_actions %} <sw-card position-identifier="frosh-abandoned-carts-automation-detail-actions" :title="$tc('frosh-abandoned-carts.automations.detail.actionsCard')" :isLoading="isLoading" > <div class="frosh-abandoned-carts-automation-detail__actions"> {% block frosh_abandoned_carts_automation_detail_actions_list %} <div v-for="(action, index) in automation.actions" :key="index" class="frosh-abandoned-carts-automation-detail__action-row" > <sw-container columns="200px 1fr auto" gap="16px" > <mt-select v-model="action.type" :label="$tc('frosh-abandoned-carts.automations.detail.actionType')" :options="actionTypeOptions" /> <div class="frosh-abandoned-carts-automation-detail__action-config" > <sw-container columns="repeat(auto-fit, minmax(200px, 1fr))" gap="8px" > <sw-entity-single-select v-if="needsMailTemplateInput(action.type)" v-model:value="action.mailTemplateId" entity="mail_template" label-property="description" :label="$tc('frosh-abandoned-carts.automations.detail.mailTemplateId')" /> <sw-entity-single-select v-if="needsPromotionInput(action.type)" v-model:value="action.promotionId" entity="promotion" :label="$tc('frosh-abandoned-carts.automations.detail.promotionId')" /> <mt-text-field v-if="needsPromotionInput(action.type)" v-model="action.codePattern" :label="$tc('frosh-abandoned-carts.automations.detail.codePattern')" /> <sw-entity-single-select v-if="needsTagActionInput(action.type)" v-model:value="action.tagId" entity="tag" :label="$tc('frosh-abandoned-carts.automations.detail.tagId')" /> <mt-text-field v-if="needsCustomFieldInput(action.type)" v-model="action.customFieldName" :label="$tc('frosh-abandoned-carts.automations.detail.customFieldName')" /> <mt-text-field v-if="needsCustomFieldInput(action.type)" v-model="action.value" :label="$tc('frosh-abandoned-carts.automations.detail.value')" /> </sw-container> </div> <mt-button square size="small" variant="secondary" @click="removeAction(index)" > <mt-icon name="regular-trash" size="16px" /> </mt-button> </sw-container> </div> {% endblock %} {% block frosh_abandoned_carts_automation_detail_actions_add %} <mt-button variant="secondary" size="small" @click="addAction" > {{ $tc('frosh-abandoned-carts.automations.detail.addAction') }} </mt-button> {% endblock %} </div> </sw-card> {% endblock %} {% block frosh_abandoned_carts_automation_detail_test_modal %} <sw-modal v-if="showTestModal" :title="$tc('frosh-abandoned-carts.automations.detail.testModalTitle')" @modal-close="closeTestModal" > <div v-if="testResults" class="frosh-abandoned-carts-automation-detail__test-results" > <div class="frosh-abandoned-carts-automation-detail__test-summary" > <strong> {{ $tc('frosh-abandoned-carts.automations.detail.testMatchingCount', { count: testResults.matchingCount, total: testResults.totalCount }) }} </strong> </div> <div v-if="testResults.matchingCarts.length > 0" class="frosh-abandoned-carts-automation-detail__test-matching" > <h4> {{ $tc('frosh-abandoned-carts.automations.detail.testMatchingCarts') }} </h4> <table class="frosh-abandoned-carts-automation-detail__test-table" > <thead> <tr> <th> {{ $tc('frosh-abandoned-carts.automations.detail.testCustomer') }} </th> <th> {{ $tc('frosh-abandoned-carts.automations.detail.testValue') }} </th> <th> {{ $tc('frosh-abandoned-carts.automations.detail.testCreatedAt') }} </th> <th> {{ $tc('frosh-abandoned-carts.automations.detail.testAutomationRuns') }} </th> </tr> </thead> <tbody> <tr v-for="cart in testResults.matchingCarts" :key="cart.id" > <td> {{ cart.customerName }} <br/> <small>{{ cart.customerEmail }}</small> </td> <td> {{ formatPrice(cart.totalPrice, cart.currencyIsoCode) }} </td> <td>{{ cart.createdAt }}</td> <td>{{ cart.automationCount }}</td> </tr> </tbody> </table> </div> <div v-else class="frosh-abandoned-carts-automation-detail__test-no-match" > {{ $tc('frosh-abandoned-carts.automations.detail.testNoMatches') }} </div> </div> <template #modal-footer> <mt-button variant="primary" @click="closeTestModal" > {{ $tc('global.default.close') }} </mt-button> </template> </sw-modal> {% endblock %} </sw-card-view> <sw-loader v-else/> </template> {% endblock %} </sw-page> {% endblock %}`,{Criteria:f}=Shopware.Data;Shopware.Component.register("frosh-abandoned-carts-automation-detail",{template:p,inject:["repositoryFactory","froshAbandonedCartAutomationApiService"],props:{automationId:{type:String,required:!1,default:null}},data(){return{automation:null,isLoading:!1,isSaveSuccessful:!1,testResults:null,isTestLoading:!1,showTestModal:!1}},computed:{automationRepository(){return this.repositoryFactory.create("frosh_abandoned_cart_automation")},isCreateMode(){return!this.automationId},criteria(){const t=new f;return t.addAssociation("salesChannel"),t},conditionTypeOptions(){return[{id:"cart_age",value:"cart_age",label:this.$tc("frosh-abandoned-carts.automations.conditions.cart_age")},{id:"cart_value",value:"cart_value",label:this.$tc("frosh-abandoned-carts.automations.conditions.cart_value")},{id:"automation_count",value:"automation_count",label:this.$tc("frosh-abandoned-carts.automations.conditions.automation_count")},{id:"time_since_last_automation",value:"time_since_last_automation",label:this.$tc("frosh-abandoned-carts.automations.conditions.time_since_last_automation")},{id:"customer_tag",value:"customer_tag",label:this.$tc("frosh-abandoned-carts.automations.conditions.customer_tag")},{id:"line_item_count",value:"line_item_count",label:this.$tc("frosh-abandoned-carts.automations.conditions.line_item_count")}]},actionTypeOptions(){return[{id:"send_email",value:"send_email",label:this.$tc("frosh-abandoned-carts.automations.actions.send_email")},{id:"generate_voucher",value:"generate_voucher",label:this.$tc("frosh-abandoned-carts.automations.actions.generate_voucher")},{id:"add_customer_tag",value:"add_customer_tag",label:this.$tc("frosh-abandoned-carts.automations.actions.add_customer_tag")},{id:"remove_customer_tag",value:"remove_customer_tag",label:this.$tc("frosh-abandoned-carts.automations.actions.remove_customer_tag")},{id:"set_customer_custom_field",value:"set_customer_custom_field",label:this.$tc("frosh-abandoned-carts.automations.actions.set_customer_custom_field")}]},operatorOptions(){return[{id:"gt",value:"gt",label:">"},{id:"gte",value:"gte",label:">="},{id:"lt",value:"lt",label:"<"},{id:"lte",value:"lte",label:"<="},{id:"eq",value:"eq",label:"="},{id:"neq",value:"neq",label:"!="}]},unitOptions(){return[{id:"hours",value:"hours",label:this.$tc("frosh-abandoned-carts.automations.detail.hours")},{id:"days",value:"days",label:this.$tc("frosh-abandoned-carts.automations.detail.days")}]}},created(){this.isCreateMode?this.createAutomation():this.loadAutomation()},methods:{createAutomation(){this.automation=this.automationRepository.create(Shopware.Context.api),this.automation.active=!1,this.automation.priority=1,this.automation.conditions=[],this.automation.actions=[]},async loadAutomation(){this.isLoading=!0;try{this.automation=await this.automationRepository.get(this.automationId,Shopware.Context.api,this.criteria),Array.isArray(this.automation.conditions)||(this.automation.conditions=[]),Array.isArray(this.automation.actions)||(this.automation.actions=[])}catch(t){console.error("Failed to load automation:",t)}finally{this.isLoading=!1}},async onSave(){this.isLoading=!0,this.isSaveSuccessful=!1;try{await this.automationRepository.save(this.automation,Shopware.Context.api),this.isSaveSuccessful=!0,this.isCreateMode&&this.$router.push({name:"frosh.abandoned.carts.automation.detail",params:{id:this.automation.id}})}catch(t){console.error("Failed to save automation:",t)}finally{this.isLoading=!1}},addCondition(){Array.isArray(this.automation.conditions)||(this.automation.conditions=[]),this.automation.conditions.push({type:"cart_age",operator:"gte",value:24,unit:"hours",negate:!1})},removeCondition(t){Array.isArray(this.automation.conditions)&&this.automation.conditions.splice(t,1)},addAction(){Array.isArray(this.automation.actions)||(this.automation.actions=[]),this.automation.actions.push({type:"send_email",mailTemplateId:null,promotionId:null,codePattern:"CART-%s%s%d%d",tagId:null,customFieldName:"",value:""})},removeAction(t){Array.isArray(this.automation.actions)&&this.automation.actions.splice(t,1)},getConditionTypeLabel(t){const a=this.conditionTypeOptions.find(e=>e.value===t);return a?a.label:t},getActionTypeLabel(t){const a=this.actionTypeOptions.find(e=>e.value===t);return a?a.label:t},needsValueInput(t){return["cart_age","cart_value","automation_count","time_since_last_automation","line_item_count"].includes(t)},needsUnitInput(t){return["cart_age","time_since_last_automation"].includes(t)},needsTagInput(t){return t==="customer_tag"},needsMailTemplateInput(t){return t==="send_email"},needsPromotionInput(t){return t==="generate_voucher"},needsTagActionInput(t){return["add_customer_tag","remove_customer_tag"].includes(t)},needsCustomFieldInput(t){return t==="set_customer_custom_field"},async testAutomation(){this.isTestLoading=!0,this.testResults=null;try{this.testResults=await this.froshAbandonedCartAutomationApiService.testAutomation(this.automation.conditions||[],this.automation.salesChannelId),this.showTestModal=!0}catch(t){console.error("Failed to test automation:",t)}finally{this.isTestLoading=!1}},closeTestModal(){this.showTestModal=!1,this.testResults=null},formatPrice(t,a){return new Intl.NumberFormat("en-US",{style:"currency",currency:a||"EUR"}).format(t)}}});Shopware.Service("privileges").addPrivilegeMappingEntry({category:"additional_permissions",parent:null,key:"frosh_abandoned_carts",roles:{frosh_abandoned_carts:{privileges:["frosh_abandoned_carts:read","frosh_abandoned_cart:read","frosh_abandoned_cart_line_item:read"],dependencies:[]}}});Shopware.Module.register("frosh-abandoned-carts",{type:"plugin",name:"frosh-abandoned-carts",title:"frosh-abandoned-carts.general.title",description:"frosh-abandoned-carts.general.description",color:"#ff6b35",icon:"regular-shopping-cart",routes:{list:{component:"frosh-abandoned-carts-list",path:"list",meta:{privilege:"frosh_abandoned_carts:read"}},detail:{component:"frosh-abandoned-carts-detail",path:"detail/:id",meta:{privilege:"frosh_abandoned_carts:read",parentPath:"frosh.abandoned.carts.list"},props:{default:t=>({abandonedCartId:t.params.id})}},statistics:{component:"frosh-abandoned-carts-statistics",path:"statistics",meta:{privilege:"frosh_abandoned_carts:read",parentPath:"frosh.abandoned.carts.list"}},automations:{component:"frosh-abandoned-carts-automation-list",path:"automations",meta:{privilege:"frosh_abandoned_carts:read",parentPath:"frosh.abandoned.carts.list"}},"automation.detail":{component:"frosh-abandoned-carts-automation-detail",path:"automations/detail/:id",meta:{privilege:"frosh_abandoned_carts:read",parentPath:"frosh.abandoned.carts.automations"},props:{default:t=>({automationId:t.params.id})}},"automation.create":{component:"frosh-abandoned-carts-automation-detail",path:"automations/create",meta:{privilege:"frosh_abandoned_carts:read",parentPath:"frosh.abandoned.carts.automations"}}},navigation:[{id:"frosh-abandoned-carts",label:"frosh-abandoned-carts.general.title",color:"#ff6b35",icon:"regular-shopping-cart",parent:"sw-customer",position:100,privilege:"frosh_abandoned_carts:read"},{path:"frosh.abandoned.carts.list",label:"frosh-abandoned-carts.general.overview",color:"#ff6b35",parent:"frosh-abandoned-carts",privilege:"frosh_abandoned_carts:read"},{path:"frosh.abandoned.carts.statistics",label:"frosh-abandoned-carts.general.statistics",color:"#ff6b35",parent:"frosh-abandoned-carts",privilege:"frosh_abandoned_carts:read"},{id:"frosh-abandoned-carts-automations",path:"frosh.abandoned.carts.automations",label:"frosh-abandoned-carts.automations.title",color:"#ff6b35",parent:"frosh-abandoned-carts",privilege:"frosh_abandoned_carts:read"}]});const d=Shopware.Classes.ApiService;class g extends d{constructor(a,e,o="frosh-abandoned-cart"){super(a,e,o),this.name="froshAbandonedCartStatisticsService"}getStatistics(a,e){return this.httpClient.get(`/_action/${this.apiEndpoint}/statistics`,{params:{since:a,timezone:e},headers:this.getBasicHeaders()}).then(o=>d.handleResponse(o))}}const l=Shopware.Classes.ApiService;class y extends l{constructor(a,e,o="frosh-abandoned-cart"){super(a,e,o),this.name="froshAbandonedCartAutomationApiService"}testAutomation(a,e){const o=this.getBasicHeaders();return this.httpClient.post("/_action/frosh-abandoned-cart/automation/test",{conditions:a,salesChannelId:e},{headers:o}).then(s=>l.handleResponse(s))}}const{Application:n}=Shopware;n.addServiceProvider("froshAbandonedCartStatisticsService",t=>{const a=n.getContainer("init");return new g(a.httpClient,t.loginService)});n.addServiceProvider("froshAbandonedCartAutomationApiService",t=>{const a=n.getContainer("init");return new y(a.httpClient,t.loginService)});
//# sourceMappingURL=frosh-abandoned-cart-CK-W4K24.js.map
